
# PeerPipe: Secure ZTNA Gateway with Built-in IDS/IPS

![Python Version](https://img.shields.io/badge/python-3.10%2B-blue)
![Type](https://img.shields.io/badge/security-Blue_Team-red)

**PeerPipe** ‚Äî —ç—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –ø–æ –º–æ–¥–µ–ª–∏ **Zero Trust Network Access (ZTNA)** —Å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ–º –†–æ—Å—Å–∏–π—Å–∫–æ–≥–æ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –æ –°–ó–ò.

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö VPN, PeerPipe —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É **Terminating Gateway**: —Ç—Ä–∞—Ñ–∏–∫ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ –∑–∞—â–∏—â–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –ø–æ–¥–≤–µ—Ä–≥–∞–µ—Ç—Å—è –≥–ª—É–±–æ–∫–æ–π –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ (DPI) –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –≤—Ç–æ—Ä–∂–µ–Ω–∏–π (**IDS Suricata**) –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ–π —Ü–µ–ª–µ–≤–æ–º—É —Å–µ—Ä–≤–∏—Å—É. –≠—Ç–æ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –ø—Ä–æ–±–ª–µ–º—É ¬´—Å–ª–µ–ø–æ–≥–æ –ø—è—Ç–Ω–∞¬ª (blind spot) –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—É–Ω–Ω–µ–ª—è—Ö –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞—Ç–∞–∫–∏ –≤–Ω—É—Ç—Ä–∏ –ø–µ—Ä–∏–º–µ—Ç—Ä–∞.

---

## –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*   **IPS:** –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å Suricata –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç—Ä–∞—Ñ–∏–∫ –Ω–∞ –ª–µ—Ç—É. –ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä –∞—Ç–∞–∫ (—ç–∫—Å–ø–ª–æ–π—Ç—ã, —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ) —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è.
*   **Mesh —Å–µ—Ç—å:** –ü—Ä—è–º–æ–µ P2P-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (UDP Hole Punching) —á–µ—Ä–µ–∑ WebRTC. –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–≥–æ —É–∑–ª–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö.
*   **–ú–∏–∫—Ä–æ—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è:** –î–æ—Å—Ç—É–ø –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ—Ä—Ç—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∞ –Ω–µ –∫–æ –≤—Å–µ–π –ø–æ–¥—Å–µ—Ç–∏ (–∑–∞—â–∏—Ç–∞ –æ—Ç Lateral Movement).
*   **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** –®–ª—é–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É—è—Å—å —Å docker compose.
*   **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ üá∑üá∫:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (—Ç—É–Ω–Ω–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ) –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –ì–û–°–¢ –† 34.12-2015 (¬´–ö—É–∑–Ω–µ—á–∏–∫¬ª).
*   **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π I/O (`uvloop`), –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–µ —Å–∂–∞—Ç–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ (`Zstd`/`LZ4`).

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

*   **`server/`** ‚Äî –°–∏–≥–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (Signaling Server) –Ω–∞ –±–∞–∑–µ Quart/Hypercorn. –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π, –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏, –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ.
*   **`gui_client/`** ‚Äî **PeerPipe Desktop**. –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∫–ª–∏–µ–Ω—Ç (PyQt6) –¥–ª—è –∫–æ–Ω–µ—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤).
*   **`cli_client/`** ‚Äî **PeerPipe Gateway**. –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π Suricata. –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤ headless-—Ä–µ–∂–∏–º–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö.
*   **`docs/`** ‚Äî –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ö–µ–º—ã.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

### 1. –°–∏–≥–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (Server)

–ù–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è "–∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞" –∫–ª–∏–µ–Ω—Ç–æ–≤ (–æ–±–º–µ–Ω–∞ SDP/ICE –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏).

```bash
cd server
# –°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Å–∞–º–æ–ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞)
openssl req -x509 -newkey rsa:4096 -keyout certs/server.key -out certs/server.crt -days 365 -nodes

# –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –∑–∞–ø—É—Å–∫
python main.py

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–ª–∏–∑ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç uvloop/winloop –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
hypercorn -c file:hypercorn_config.py main:app
```
*–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ `hypercorn_config.py`.*

### 2. –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∫–ª–∏–µ–Ω—Ç (Desktop)

–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Windows/Linux/macOS.

```bash
cd gui_client
pip install -r requirements.txt

# –ó–∞–ø—É—Å–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
python main.py
```

### 3. –®–ª—é–∑ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (CLI / Docker)

–î–ª—è –∑–∞—â–∏—Ç—ã —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –≤ –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö. –í–∫–ª—é—á–∞–µ—Ç IDS Suricata.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** Docker, Linux (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è).

```bash
cd cli_client

# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ (–≤–∫–ª—é—á–∞–µ—Ç Suricata –∏ Python-–æ–∫—Ä—É–∂–µ–Ω–∏–µ)
docker build -t peerpipe-gateway .

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose - —Ç–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
docker-compose up -d --build --remove-orphans
```

*–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —à–ª—é–∑–∞ (—Ç–æ–∫–µ–Ω—ã, –ø–æ—Ä—Ç—ã –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞) –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `cli_client/app/config.py`.*

> **–í–∞–∂–Ω–æ:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤–∞ `CAP_NET_RAW` (—É–∫–∞–∑–∞–Ω–æ –≤ compose —Ñ–∞–π–ª–µ) –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ —Ç—Ä–∞—Ñ–∏–∫–∞ –º–æ–¥—É–ª–µ–º IDS –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ loopback.

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ MITRE ATT&CK

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç **Blue Team** –¥–ª—è –ø—Ä–æ—Ç–∏–≤–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–ª–µ–¥—É—é—â–∏–º —Ç–∞–∫—Ç–∏–∫–∞–º –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤:

| ID | –¢–∞–∫—Ç–∏–∫–∞ / –¢–µ—Ö–Ω–∏–∫–∞ | –ú–µ—Ä–∞ –ø—Ä–æ—Ç–∏–≤–æ–¥–µ–π—Å—Ç–≤–∏—è –≤ PeerPipe |
| :--- | :--- | :--- |
| **T1021** | **Lateral Movement** (Remote Services) | **–ú–∏–∫—Ä–æ—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è:** –î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω —Å—Ç—Ä–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –ø–æ—Ä—Ç–∞–º–∏ —á–µ—Ä–µ–∑ ACL. |
| **T1572** | **Command and Control** (Protocol Tunneling) | **DPI / IDS:** Suricata –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç payload –≤–Ω—É—Ç—Ä–∏ —Ç—É–Ω–Ω–µ–ª—è –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤. |
| **T1046** | **Discovery** (Network Service Scanning) | **Active Defense:** –ú–æ–¥—É–ª—å Sentinel –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç –ø–æ–ø—ã—Ç–∫–∏ –ø–µ—Ä–µ–±–æ—Ä–∞ –ø–æ—Ä—Ç–æ–≤ –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–∏—Ä–∞. |
| **T1048** | **Exfiltration** (Alternative Protocol) | **–°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è:** –®–ª—é–∑ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ "Air Gap" –¥–ª—è –∑–∞—â–∏—â–∞–µ–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤. |

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

*   [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å—Ö–µ–º—ã –∏ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](docs/schemes.md)
*   [–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ "–ö–ª–∏–µ–Ω—Ç-–ö–ª–∏–µ–Ω—Ç" (v1.0 & v1.1-G)](docs/spec_client_proto.md)
*   [–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è —Å–∏–≥–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞](docs/spec_server_proto.md)
